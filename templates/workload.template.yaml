AWSTemplateFormatVersion: 2010-09-09
Description: >-
  This template deploys a high availability pair of BIG-IPs and demo applications **WARNING**
  This template creates multiple AWS resources including S3 bucket, IAM
  roles and other related resources. You will be billed for the AWS resources used if you
  create a stack from this template.(qs-1p2474b6a)
Mappings:
  AWSBigipThroughput:
    1000Mbps:
      AllTwoBootLocations: AllTwoBootLocations
      Best: Best1000Mbps
    200Mbps:
      AdvancedWaf: AdvancedWaf200Mbps
      AllTwoBootLocations: AllTwoBootLocations
      Best: Best200Mbps
    25Mbps:
      AdvancedWaf: AdvancedWaf25Mbps
      AllTwoBootLocations: AllTwoBootLocations
      Best: Best25Mbps
    3000Mbps:
      AdvancedWaf: AdvancedWaf3000Mbps
      AllTwoBootLocations: AllTwoBootLocations
    5000Mbps:
      AllTwoBootLocations: AllTwoBootLocations
      Best: Best5000Mbps
    10000Mbps:
      AllTwoBootLocations: AllTwoBootLocations
      Best: Best10000Mbps
  VERSION:
    16-1-2-2-0028:
      REGIONMAP: TMOS161220028
    14-1-4-6-008:
      REGIONMAP: TMOS14146008
  TMOS161220028:
    af-south-1:
      AdvancedWaf200Mbps: ami-0ebe9b603383c00ec
      AdvancedWaf25Mbps: ami-011bc921fe461992a
      AdvancedWaf3000Mbps: ami-06ff888f5b94afe08
      AllTwoBootLocations: ami-0533a5ca2f72739cb
      Best10000Mbps: ami-0a442ed1a12510755
      Best1000Mbps: ami-021a348e3cb68e934
      Best200Mbps: ami-00683ff68067c379f
      Best25Mbps: ami-0285d9633e321aa48
      Best5000Mbps: ami-06dc69261facbf203
    ap-east-1:
      AdvancedWaf200Mbps: ami-09d7b89efd2808627
      AdvancedWaf25Mbps: ami-0d138ad5fd0e0fbb8
      AdvancedWaf3000Mbps: ami-0a05f849abe4de2d6
      AllTwoBootLocations: ami-09b7720294469933c
      Best10000Mbps: ami-018f0fb28a85173bc
      Best1000Mbps: ami-0aa01ddcb9e8608d3
      Best200Mbps: ami-0ee596456c1292d70
      Best25Mbps: ami-0a33ca6957c9b392e
      Best5000Mbps: ami-0fc3727ae42322221
    ap-northeast-1:
      AdvancedWaf200Mbps: ami-092d2f6984c9ccef6
      AdvancedWaf25Mbps: ami-0cd4ea9f443534973
      AdvancedWaf3000Mbps: ami-0e765192f4d0098a2
      AllTwoBootLocations: ami-09ae2aa8399de5afb
      Best10000Mbps: ami-05ed6589635a9c9ba
      Best1000Mbps: ami-00c8ca7da0bf270dd
      Best200Mbps: ami-0216821c6c2665fea
      Best25Mbps: ami-08d481585f970cbe2
      Best5000Mbps: ami-05332f679d9f28a14
    ap-northeast-2:
      AdvancedWaf200Mbps: ami-03513a2c5e8597b02
      AdvancedWaf25Mbps: ami-0733de272db5b969f
      AdvancedWaf3000Mbps: ami-0c1b47c9e291bc3c8
      AllTwoBootLocations: ami-017e211b350cd590a
      Best10000Mbps: ami-03ec8ff04e0dc58a1
      Best1000Mbps: ami-07ad184ffaf71b648
      Best200Mbps: ami-0b1e49b3f187607ce
      Best25Mbps: ami-0b2d49d8e37e50c54
      Best5000Mbps: ami-0634221ce565015e3
    ap-northeast-3:
      AdvancedWaf200Mbps: ami-08fb83c87265b61ee
      AdvancedWaf25Mbps: ami-07661cf92d188ca35
      AdvancedWaf3000Mbps: ami-08324213f678ab52e
      AllTwoBootLocations: ami-0b1e1d92a52a2f9d9
      Best10000Mbps: ami-01e030c1ccae0362e
      Best1000Mbps: ami-030015406dcf3b615
      Best200Mbps: ami-039e08ff67d3b0d16
      Best25Mbps: ami-030e8242c7433d808
      Best5000Mbps: ami-0a010a18af02577ec
    ap-south-1:
      AdvancedWaf200Mbps: ami-0f2a07804717de746
      AdvancedWaf25Mbps: ami-0615ce3fb685d6e33
      AdvancedWaf3000Mbps: ami-0036da3755c3f35c9
      AllTwoBootLocations: ami-0964482d488fb0433
      Best10000Mbps: ami-08ed20947a2dedda4
      Best1000Mbps: ami-008f7d97929c8c758
      Best200Mbps: ami-093aed36c43bccb03
      Best25Mbps: ami-0da2631c74cce7dc1
      Best5000Mbps: ami-01f9618f18f57d2c6
    ap-southeast-1:
      AdvancedWaf200Mbps: ami-08a020be8428b206d
      AdvancedWaf25Mbps: ami-08c3ed76e019f2d62
      AdvancedWaf3000Mbps: ami-0734ae2697e4c1d9d
      AllTwoBootLocations: ami-076f1d7a054fd558b
      Best10000Mbps: ami-0a9ad3fbbe0650aa4
      Best1000Mbps: ami-0b0268dbd37226d80
      Best200Mbps: ami-031824b97b7093afd
      Best25Mbps: ami-06b20319b678f177a
      Best5000Mbps: ami-0827ef35474550b67
    ap-southeast-2:
      AdvancedWaf200Mbps: ami-00d1467343ee33160
      AdvancedWaf25Mbps: ami-051c82bbb1a9e9cbe
      AdvancedWaf3000Mbps: ami-01b1358e81df52138
      AllTwoBootLocations: ami-0e7e3e854f4fc7cc3
      Best10000Mbps: ami-0d1e423ad5384346e
      Best1000Mbps: ami-079e3f3cbe7597407
      Best200Mbps: ami-04fc5ae44c9e29887
      Best25Mbps: ami-0bc8b5696d632b808
      Best5000Mbps: ami-019fedbdf68044a00
    ca-central-1:
      AdvancedWaf200Mbps: ami-0aac68a886a9f8a1e
      AdvancedWaf25Mbps: ami-0796e5091d0be3a5f
      AdvancedWaf3000Mbps: ami-08b96d1db2cbb8654
      AllTwoBootLocations: ami-02737b3c1cc6d5c2f
      Best10000Mbps: ami-0481ef1b7a9b39f72
      Best1000Mbps: ami-054780bf4a23e9f91
      Best200Mbps: ami-068c52f99ed279630
      Best25Mbps: ami-014828384797b78af
      Best5000Mbps: ami-0f5f7b5934a806f52
    eu-central-1:
      AdvancedWaf200Mbps: ami-055ee83c0157adea4
      AdvancedWaf25Mbps: ami-000045fcf62931326
      AdvancedWaf3000Mbps: ami-09816abf0aef9bb80
      AllTwoBootLocations: ami-0c5ffc78b6f732c33
      Best10000Mbps: ami-01af590e53411be7d
      Best1000Mbps: ami-0c0dc7fcdcc1133de
      Best200Mbps: ami-02ac3dbe8966e634f
      Best25Mbps: ami-04698c7a253948104
      Best5000Mbps: ami-07b56ca0612650908
    eu-north-1:
      AdvancedWaf200Mbps: ami-0c902067b5a735272
      AdvancedWaf25Mbps: ami-07c8b8d7a674d0241
      AdvancedWaf3000Mbps: ami-0d5dfc691b8bbec7d
      AllTwoBootLocations: ami-0a17a9d02897eb6d6
      Best10000Mbps: ami-049cf36166ed6bab5
      Best1000Mbps: ami-08ff20c3d21dc452a
      Best200Mbps: ami-0276a44f7c2eb392f
      Best25Mbps: ami-0aa8cb773a29a33b3
      Best5000Mbps: ami-0bf591636c5256209
    eu-south-1:
      AdvancedWaf200Mbps: ami-0b7587a3b6933cd00
      AdvancedWaf25Mbps: ami-0fb518cf9d6e5ebb4
      AdvancedWaf3000Mbps: ami-07810abee0098a862
      AllTwoBootLocations: ami-058634801dd2a251a
      Best10000Mbps: ami-0d54692ccfd91e731
      Best1000Mbps: ami-08575fdd518a927f4
      Best200Mbps: ami-0a8f33f8bcf7b7b48
      Best25Mbps: ami-0d6f7a55372f3f266
      Best5000Mbps: ami-0c83af188742f0c8c
    eu-west-1:
      AdvancedWaf200Mbps: ami-01b91e958cfee98a6
      AdvancedWaf25Mbps: ami-0658c10370ef586e9
      AdvancedWaf3000Mbps: ami-0787e57b9ab409f13
      AllTwoBootLocations: ami-01d8781aeb5813ad5
      Best10000Mbps: ami-03a81f58f8a62c266
      Best1000Mbps: ami-0023d53ae54a5d1bb
      Best200Mbps: ami-03c23b8461b6ee38c
      Best25Mbps: ami-073d220b50d143e06
      Best5000Mbps: ami-0a43c3f525fe7e2cf
    eu-west-2:
      AdvancedWaf200Mbps: ami-0424d31f40aaa7a04
      AdvancedWaf25Mbps: ami-07bb07475c86722c7
      AdvancedWaf3000Mbps: ami-09d18d824cd17b201
      AllTwoBootLocations: ami-0d4d764198e0ea5ff
      Best10000Mbps: ami-02457c0f080d4cb8a
      Best1000Mbps: ami-06e46908e60c5efd2
      Best200Mbps: ami-050683b10be1fc505
      Best25Mbps: ami-0f009088123a22834
      Best5000Mbps: ami-01e39629cdca6dd86
    eu-west-3:
      AdvancedWaf200Mbps: ami-08f43541532a305ed
      AdvancedWaf25Mbps: ami-066ca06b7371ceda1
      AdvancedWaf3000Mbps: ami-06403aa1843d1846f
      AllTwoBootLocations: ami-03142f096ee99e351
      Best10000Mbps: ami-040b10f7579700f74
      Best1000Mbps: ami-00f1ff76fc1d3e3be
      Best200Mbps: ami-00b3c323f4546d48c
      Best25Mbps: ami-046a814b546e866aa
      Best5000Mbps: ami-02c422e6b575dde76
    me-south-1:
      AdvancedWaf200Mbps: ami-05fa0ec2ff86e10e0
      AdvancedWaf25Mbps: ami-026c95894a7243159
      AdvancedWaf3000Mbps: ami-022eac6cba508cf15
      AllTwoBootLocations: ami-01390b8e01f07faa0
      Best10000Mbps: ami-0d57b11161ea5e072
      Best1000Mbps: ami-086300dcb1b5510de
      Best200Mbps: ami-02f54a12209c926df
      Best25Mbps: ami-0dc5564a0e4806147
      Best5000Mbps: ami-04214325116f09097
    sa-east-1:
      AdvancedWaf200Mbps: ami-0a47bf096feb1a5e9
      AdvancedWaf25Mbps: ami-0041f111d3eed828e
      AdvancedWaf3000Mbps: ami-02bf27f5d32141e12
      AllTwoBootLocations: ami-0025f7354c48aee04
      Best10000Mbps: ami-012d00b20dd4207cb
      Best1000Mbps: ami-01d02a194ff374143
      Best200Mbps: ami-09d6745a3b02a24d1
      Best25Mbps: ami-0016167998820e8f8
      Best5000Mbps: ami-01b2de26f505df4fe
    us-east-1:
      AdvancedWaf200Mbps: ami-0c1bcf14f499c7ef8
      AdvancedWaf25Mbps: ami-06d200e6a057d9714
      AdvancedWaf3000Mbps: ami-0edf719cd5ac6b3ef
      AllTwoBootLocations: ami-07bb79b3d693bf4e5
      Best10000Mbps: ami-04a4c754c4acaef46
      Best1000Mbps: ami-08db730aba1f4f420
      Best200Mbps: ami-001900f39dd6ac291
      Best25Mbps: ami-0be7b90e8c29affd4
      Best5000Mbps: ami-0898e461fb10458ea
    us-east-2:
      AdvancedWaf200Mbps: ami-041c3f7795998b1a3
      AdvancedWaf25Mbps: ami-08ef7cba8bca4ce14
      AdvancedWaf3000Mbps: ami-049ca6304734f7843
      AllTwoBootLocations: ami-0271c595ba662fc67
      Best10000Mbps: ami-00a7ebd70cc625012
      Best1000Mbps: ami-00f76269b46d98c06
      Best200Mbps: ami-0452132792ead9fe0
      Best25Mbps: ami-04ee3f728d1660634
      Best5000Mbps: ami-023384c14e2591210
    us-gov-east-1:
      AdvancedWaf200Mbps: ami-09345d19155e2072f
      AdvancedWaf25Mbps: ami-0d72b6960006d0abf
      AdvancedWaf3000Mbps: ami-02cc0d5923740bf34
      AllTwoBootLocations: ami-0657b3f99810b641b
      Best10000Mbps: ami-01c3416c0e4ba6750
      Best1000Mbps: ami-00659c1a8b03908af
      Best200Mbps: ami-0bdff51c57ce1d4aa
      Best25Mbps: ami-02e85c9dd94df612e
      Best5000Mbps: ami-03e257e34cfb2aa24
    us-gov-west-1:
      AdvancedWaf200Mbps: ami-059726b11bdad0073
      AdvancedWaf25Mbps: ami-0f4df72a86dc5b8db
      AdvancedWaf3000Mbps: ami-04dbaa62a2748adea
      AllTwoBootLocations: ami-0d85fbcefe0e5e7fa
      Best10000Mbps: ami-0050465b00df95b2d
      Best1000Mbps: ami-043b0e9564ebc1f61
      Best200Mbps: ami-03de744fd2f6761f4
      Best25Mbps: ami-01ab459e642cd66d8
      Best5000Mbps: ami-05a1467f88ed96bdb
    us-west-1:
      AdvancedWaf200Mbps: ami-07e59ccc4964a72b9
      AdvancedWaf25Mbps: ami-0969393fd6bb2ef5e
      AdvancedWaf3000Mbps: ami-045a3f93be44c0cae
      AllTwoBootLocations: ami-0607a1ba16abf0924
      Best10000Mbps: ami-04cd48612b393447d
      Best1000Mbps: ami-0bef126ca2129a95c
      Best200Mbps: ami-077c07d84503203b2
      Best25Mbps: ami-056b142fdbb0439e0
      Best5000Mbps: ami-022a6173b9b380868
    us-west-2:
      AdvancedWaf200Mbps: ami-0f79a1f45fc49778d
      AdvancedWaf25Mbps: ami-0626fd6a58acaa564
      AdvancedWaf3000Mbps: ami-08e42f0b497d08997
      AllTwoBootLocations: ami-062be6fc0eb3c02d8
      Best10000Mbps: ami-09e41d1d64d415e2b
      Best1000Mbps: ami-09a55ffefb8fa7824
      Best200Mbps: ami-020c33309beaf985f
      Best25Mbps: ami-0710dc346b1da739a
      Best5000Mbps: ami-0334a0642161995ba
  TMOS14146008:
    af-south-1:
      AdvancedWaf200Mbps: ami-0a68aef60c3f1ebbe
      AdvancedWaf25Mbps: ami-0c79d3b12f0411b61
      AdvancedWaf3000Mbps: ami-0e7583926a6e0988a
      AllTwoBootLocations: ami-0717736f43516565a
      Best10000Mbps: ami-02709495fa0b19551
      Best1000Mbps: ami-07217436f2694aff6
      Best200Mbps: ami-00f9b676acf392fe1
      Best25Mbps: ami-0d5e9c43e8891b8a7
      Best5000Mbps: ami-014407b39af8ed561
    ap-east-1:
      AdvancedWaf200Mbps: ami-0ab24827ea01875ff
      AdvancedWaf25Mbps: ami-05b821c53a6349d62
      AdvancedWaf3000Mbps: ami-0be10c43da08bbb9e
      AllTwoBootLocations: ami-088e5130c8b8a2633
      Best10000Mbps: ami-0b7b3d04ff19a01a1
      Best1000Mbps: ami-0c6f2aaa249dd85aa
      Best200Mbps: ami-012d0efe30ccdf7fe
      Best25Mbps: ami-0e0763e7285ba4e09
      Best5000Mbps: ami-0594458956a617d24
    ap-northeast-1:
      AdvancedWaf200Mbps: ami-0181d41836f295d30
      AdvancedWaf25Mbps: ami-0f33df9f42072f0bf
      AdvancedWaf3000Mbps: ami-0970f25149b059e88
      AllTwoBootLocations: ami-072921e250bd455ea
      Best10000Mbps: ami-0129664a1431fb998
      Best1000Mbps: ami-06e92d2cd10fcf738
      Best200Mbps: ami-060fc9c10f99ae659
      Best25Mbps: ami-0198e251d20518921
      Best5000Mbps: ami-006b7dc339c3a381a
    ap-northeast-2:
      AdvancedWaf200Mbps: ami-007ace1d1fe5cc431
      AdvancedWaf25Mbps: ami-0b75d703c15a95ab8
      AdvancedWaf3000Mbps: ami-06f1d5b0b83d2f591
      AllTwoBootLocations: ami-0214b57de8f04b89f
      Best10000Mbps: ami-00dbf89de957a4d57
      Best1000Mbps: ami-0682ebbd0c8b5ed0c
      Best200Mbps: ami-042b5b207cfc069a8
      Best25Mbps: ami-00e9b12098c20a63d
      Best5000Mbps: ami-062deaf757533926e
    ap-northeast-3:
      AdvancedWaf200Mbps: ami-04c0b0b7fc90d7cca
      AdvancedWaf25Mbps: ami-03cba2a0f382ea29f
      AdvancedWaf3000Mbps: ami-0058872a6f2e9fe1a
      AllTwoBootLocations: ami-045ac9b4ace44953a
      Best10000Mbps: ami-071d7a54ea09d73c3
      Best1000Mbps: ami-0011fd30f21a6e2dc
      Best200Mbps: ami-02cf86a9f542efa48
      Best25Mbps: ami-02bf87c2094953d61
      Best5000Mbps: ami-0cdce147cf90b434b
    ap-south-1:
      AdvancedWaf200Mbps: ami-07bcc89aced9f3537
      AdvancedWaf25Mbps: ami-0c7724c18be310a30
      AdvancedWaf3000Mbps: ami-07b0ce7f30e716455
      AllTwoBootLocations: ami-01550b903aadafdef
      Best10000Mbps: ami-04e75fd3a0d6f3544
      Best1000Mbps: ami-00d961431262c7449
      Best200Mbps: ami-02b8550863312b75e
      Best25Mbps: ami-08a76bece1f27750b
      Best5000Mbps: ami-0512b7732f25337fc
    ap-southeast-1:
      AdvancedWaf200Mbps: ami-0b3d4900a924270a6
      AdvancedWaf25Mbps: ami-0adaafa29e5e17353
      AdvancedWaf3000Mbps: ami-0690975c94542c20e
      AllTwoBootLocations: ami-096b5d3210488192e
      Best10000Mbps: ami-05fcfcad200c6922b
      Best1000Mbps: ami-01fc4fb0ca3cda697
      Best200Mbps: ami-077a0f94b063075fa
      Best25Mbps: ami-01d73cc1be648f379
      Best5000Mbps: ami-0572df8e0bf33ec4d
    ap-southeast-2:
      AdvancedWaf200Mbps: ami-0b976100ff94e99ec
      AdvancedWaf25Mbps: ami-0a87766727a791e33
      AdvancedWaf3000Mbps: ami-023330c75d539b36a
      AllTwoBootLocations: ami-0a077d0c6f2c081bd
      Best10000Mbps: ami-09455e0f86dee138b
      Best1000Mbps: ami-02838e1ed690a1625
      Best200Mbps: ami-011cb56611d27de00
      Best25Mbps: ami-037a543b776d68c55
      Best5000Mbps: ami-026debf175a2e8a62
    ca-central-1:
      AdvancedWaf200Mbps: ami-0d57366731a9a05a7
      AdvancedWaf25Mbps: ami-089ee55ce7f6fd06f
      AdvancedWaf3000Mbps: ami-0c83ffc68d59418be
      AllTwoBootLocations: ami-03b1169193240ebd0
      Best10000Mbps: ami-00759d9bab72ff6e4
      Best1000Mbps: ami-0c522edfd871bf4bc
      Best200Mbps: ami-09332fae9193d1d2e
      Best25Mbps: ami-08f68c6de12a7152c
      Best5000Mbps: ami-0682af24fd3eecf00
    eu-central-1:
      AdvancedWaf200Mbps: ami-0dda842f12e1ccde4
      AdvancedWaf25Mbps: ami-0e4a1334a0ce3d646
      AdvancedWaf3000Mbps: ami-049dae0d656004b73
      AllTwoBootLocations: ami-0cf6d03c56b3f4ac2
      Best10000Mbps: ami-069513f1f4b8b45dd
      Best1000Mbps: ami-00b4d01cfad29e1c9
      Best200Mbps: ami-0483e3567f8c560b5
      Best25Mbps: ami-00f5ced3734494efa
      Best5000Mbps: ami-052a8cf4315c92531
    eu-north-1:
      AdvancedWaf200Mbps: ami-05adced7270fb3ac7
      AdvancedWaf25Mbps: ami-0be9e8bbba08eebbf
      AdvancedWaf3000Mbps: ami-049841588d14cc1b8
      AllTwoBootLocations: ami-0c0f71cec8f430049
      Best10000Mbps: ami-01b85552468de5093
      Best1000Mbps: ami-022c7da54db0c3dd5
      Best200Mbps: ami-020905f911cf11b23
      Best25Mbps: ami-05184b00618e7308a
      Best5000Mbps: ami-099790dfe670aab20
    eu-south-1:
      AdvancedWaf200Mbps: ami-04aca71dd79196a7f
      AdvancedWaf25Mbps: ami-0b9b12a1c3d054ee4
      AdvancedWaf3000Mbps: ami-0eb6a61e914a8e347
      AllTwoBootLocations: ami-0d449fff9e3d9c054
      Best10000Mbps: ami-051599aa4b0bbffcc
      Best1000Mbps: ami-07f901d327f8ae947
      Best200Mbps: ami-08fa2cd2a8503aef8
      Best25Mbps: ami-0243eeb301d5afa04
      Best5000Mbps: ami-056e9eafdbe8bcd34
    eu-west-1:
      AdvancedWaf200Mbps: ami-03a72e1cad0425052
      AdvancedWaf25Mbps: ami-065cc0b61ec513a54
      AdvancedWaf3000Mbps: ami-0612666e58bc5f739
      AllTwoBootLocations: ami-005172ca41ff2c932
      Best10000Mbps: ami-04d27f414a8f62085
      Best1000Mbps: ami-013cbc6ec2f33fe82
      Best200Mbps: ami-00939b6ffda773dc0
      Best25Mbps: ami-032e2813d1c924e8b
      Best5000Mbps: ami-0aa7bf4e587444eb7
    eu-west-2:
      AdvancedWaf200Mbps: ami-0a64a6009c1762182
      AdvancedWaf25Mbps: ami-045d67f7c7de5b77d
      AdvancedWaf3000Mbps: ami-0a3be40e3116a27b3
      AllTwoBootLocations: ami-0533bdc0640db341b
      Best10000Mbps: ami-0b33cdce0bc0538e9
      Best1000Mbps: ami-0ebfab2a9ab1a765a
      Best200Mbps: ami-0130b25f9b488237f
      Best25Mbps: ami-02605e19d11730898
      Best5000Mbps: ami-0c9faacf4cd6a72c0
    eu-west-3:
      AdvancedWaf200Mbps: ami-01e8d97a901b7f0ac
      AdvancedWaf25Mbps: ami-0808e5e2261fc988a
      AdvancedWaf3000Mbps: ami-0fd4b5fdc716b5c44
      AllTwoBootLocations: ami-049f2492639cfd9cc
      Best10000Mbps: ami-0103c6aa9b0d5433e
      Best1000Mbps: ami-037c78d558f4a6429
      Best200Mbps: ami-04cbe6b9c00744429
      Best25Mbps: ami-046cc5b79ce19277f
      Best5000Mbps: ami-00b55965259c8e9fc
    me-south-1:
      AdvancedWaf200Mbps: ami-0d6e209d081f5424b
      AdvancedWaf25Mbps: ami-0a639a1d7e6ac1bc6
      AdvancedWaf3000Mbps: ami-07631bdab4b604560
      AllTwoBootLocations: ami-0ddb312fcb0e11e37
      Best10000Mbps: ami-0513459ecd3365c05
      Best1000Mbps: ami-0a53bb5259651172b
      Best200Mbps: ami-03c8afd6a015f9b42
      Best25Mbps: ami-01aec3c2f9796439d
      Best5000Mbps: ami-00737f225cc88acd0
    sa-east-1:
      AdvancedWaf200Mbps: ami-0e9cccc0ea9ce1397
      AdvancedWaf25Mbps: ami-074f0371a2a1817c2
      AdvancedWaf3000Mbps: ami-052828ec4e59d6fc2
      AllTwoBootLocations: ami-09cb97125d5a64134
      Best10000Mbps: ami-08cbb8bf4d3a04aad
      Best1000Mbps: ami-0ee5e4b30f42eee44
      Best200Mbps: ami-02ba2f0e7456124c0
      Best25Mbps: ami-040d0f7943f8f3d46
      Best5000Mbps: ami-040b13630cf03d2e6
    us-east-1:
      AdvancedWaf200Mbps: ami-0e813eb78b3afddeb
      AdvancedWaf25Mbps: ami-0e2e80c5ab6ce69f7
      AdvancedWaf3000Mbps: ami-0b89c5923f437d447
      AllTwoBootLocations: ami-08b3f6e8133bc9b16
      Best10000Mbps: ami-02f947d6c62c23d43
      Best1000Mbps: ami-04c10417dc150cd23
      Best200Mbps: ami-095416a281055938d
      Best25Mbps: ami-0526d03e072a686fb
      Best5000Mbps: ami-0523120feadc63ef7
    us-east-2:
      AdvancedWaf200Mbps: ami-08a8afd3234e14543
      AdvancedWaf25Mbps: ami-0614ab99ed0bad6ca
      AdvancedWaf3000Mbps: ami-0f0c39d0601881406
      AllTwoBootLocations: ami-0be69c4757d8109ec
      Best10000Mbps: ami-041858addd7ca8d80
      Best1000Mbps: ami-0caef31e0b31c93ab
      Best200Mbps: ami-035215417fb24cc57
      Best25Mbps: ami-048e680b3f28c1b8f
      Best5000Mbps: ami-09efae2a90c387191
    us-gov-east-1:
      AdvancedWaf200Mbps: ami-0d217a425ab258710
      AdvancedWaf25Mbps: ami-04df2bad338438321
      AdvancedWaf3000Mbps: ami-04e9f670f47142ede
      AllTwoBootLocations: ami-02eca0a8f4a79c7b5
      Best10000Mbps: ami-0486710c3b3044613
      Best1000Mbps: ami-08d3d334c09d9fbcb
      Best200Mbps: ami-0ba4765f52a30448f
      Best25Mbps: ami-01e233ae75e74854c
      Best5000Mbps: ami-03cfec51e10db9f60
    us-gov-west-1:
      AdvancedWaf200Mbps: ami-07b471c01b0e58e1b
      AdvancedWaf25Mbps: ami-021881fb4ba7b8587
      AdvancedWaf3000Mbps: ami-090728c77e9df0b95
      AllTwoBootLocations: ami-03521f797a6d0cd3a
      Best10000Mbps: ami-0292ba60001afd6de
      Best1000Mbps: ami-0765425401d44d704
      Best200Mbps: ami-01e610ca63e70a5f6
      Best25Mbps: ami-005ebcb210155a574
      Best5000Mbps: ami-04cbfac451265d937
    us-west-1:
      AdvancedWaf200Mbps: ami-0ee63d9ff9b6318da
      AdvancedWaf25Mbps: ami-0dfbc40361096c15e
      AdvancedWaf3000Mbps: ami-00fba7503a144b386
      AllTwoBootLocations: ami-03bcaa3aa12709719
      Best10000Mbps: ami-05e28dae0898d46ae
      Best1000Mbps: ami-09109398e3ec11763
      Best200Mbps: ami-0851f73abc3de107c
      Best25Mbps: ami-02033409bcf5660b6
      Best5000Mbps: ami-043530c25e4cd1507
    us-west-2:
      AdvancedWaf200Mbps: ami-0b1712737c4159c4a
      AdvancedWaf25Mbps: ami-06cc1746b0de54f2b
      AdvancedWaf3000Mbps: ami-0df5c51a9decc6be0
      AllTwoBootLocations: ami-06abe27ad705571e4
      Best10000Mbps: ami-08ebcb256518d89a0
      Best1000Mbps: ami-06b5a043c12983a20
      Best200Mbps: ami-029026ce5ed1c9cad
      Best25Mbps: ami-00f3354c008c0818d
      Best5000Mbps: ami-01c54ae69d6bf7217
Conditions:
  useDefaultBucket: !Equals [!Ref s3BucketName, 'aws-quickstart']
  usePublicIpVip: !Equals
    - 'true'
    - !Ref provisionExampleApp
  noCustomImageId: !Equals
    - ''
    - !Ref bigIpImageId
  provisionExampleApp: !Equals
    - !Ref provisionExampleApp
    - 'true'
Metadata:
  QuickStartDocumentation:
    EntrypointName: "Launch into an existing VPC"
  'AWS::CloudFormation::Interface':
    ParameterGroups:
      - Label:
          default: Deployment Configuration
        Parameters:
          - uniqueString
      - Label:
          default: Network Configuration
        Parameters:
          - vpc
          - peerConfigSyncAddr
          - publicSubnet1ID
          - publicSubnet1SelfAddress
          - privateSubnet1ID
          - privateSubnet1SelfAddress
          - publicSubnet2ID
          - publicSubnet2SelfAddress
          - privateSubnet2ID
          - privateSubnet2SelfAddress
          - privateSubnet3ID
          - privateSubnet4ID
      - Label:
          default: Amazon EC2 Configuration
        Parameters:
          - sshKey
          - restrictedSrcAddressMgmt
          - restrictedSrcAddressApp
      - Label:
          default: BIG-IP Configuration
        Parameters:
          - bigIpInstanceType
          - bigIpImageId
          - bigIpVersion
          - bigIpImageName
          - bigIpThroughput
          - bigIpRuntimeInitConfig01
          - bigIpRuntimeInitConfig02
          - bigIpRuntimeInitPackageUrl
          - cfeS3Bucket
          - cfeVipTag
          - cfeTag
          - secretArn
      - Label:
          default: Resources Tags
        Parameters:
          - application
          - cost
          - environment
          - group
          - owner
      - Label:
          default: Provision Example App
        Parameters:
          - provisionExampleApp
          - appDockerImageName
          - publicSubnet1VipAddress
          - publicSubnet2VipAddress
      - Label:
          default: Templates Location
        Parameters:
          - s3BucketName
          - s3BucketRegion
          - s3KeyPrefix
    ParameterLabels:
      appDockerImageName:
        default: Application docker image name
      application:
        default: Application
      bigIpImageName:
        default: F5 BIG-IP Performance Type (PAYG)
      bigIpImageId:
        default: BIGIP Image Id
      bigIpInstanceType:
        default: AWS instance type
      bigIpRuntimeInitConfig01:
        default: BIG-IP Runtime Init config
      bigIpRuntimeInitConfig02:
        default: BIG-IP Runtime Init config
      bigIpRuntimeInitPackageUrl:
        default: BIG-IP Runtime Init Package URL
      bigIpThroughput:
        default: BIG-IP VE throughput (PAYG)
      bigIpVersion:
        default: BIG-IP VE version.
      cfeS3Bucket:
        default: CFE S3 bucket
      cfeTag:
        default: CFE Deployment tag value
      cfeVipTag:
        default: CFE VIP tag value
      cost:
        default: Cost Center
      environment:
        default: Environment
      group:
        default: Group
      owner:
        default: Owner
      peerConfigSyncAddr:
        default: Static self IP address for peer device.
      provisionExampleApp:
        default: Provision Example App
      publicSubnet1SelfAddress:
        default: BIG-IP address for public subnet in AZ1
      publicSubnet2SelfAddress:
        default: BIG-IP address for public subnet in AZ2
      privateSubnet1ID:
        default: Private Subnet AZ1
      privateSubnet2ID:
        default: Private Subnet AZ2
      privateSubnet3ID:
        default: Private Subnet AZ1
      privateSubnet4ID:
        default: Private Subnet AZ2
      restrictedSrcAddressMgmt:
        default: Restricted source address to BIG-IP management
      restrictedSrcAddressApp:
        default: Restricted source address to application
      s3BucketName:
        default: S3 bucket where Templates are Located
      s3BucketRegion:
        default: Region where S3 bucket is located
      s3KeyPrefix:
        default: S3 key prefix
      secretArn:
        default: ARN of Secrets Manager secret
      sshKey:
        default: EC2 KeyPair to enable SSH access to the BIG-IP instance
      vpc:
        default: VPC ID
      uniqueString:
        default: unique string value which gets append to cloud resources names
  Version: 1.0.0
Parameters:
  appDockerImageName:
    Default: f5devcentral/f5-demo-httpd:latest
    Description: Application docker image name
    Type: String
  application:
    Default: f5app
    Description: Name of the Application Tag
    Type: String
  bigIpImageId:
    ConstraintDescription: Must be a valid AMI Id.
    Default: ''
    Description: 'If you would like to deploy using a custom BIG-IP image, provide the AMI Id.  **Note**: Unless specifically required, leave the default of **OPTIONAL**'
    MaxLength: 255
    MinLength: 0
    Type: String
  bigIpImageName:
    AllowedValues:
      - Best
      - AdvancedWaf
      - AllTwoBootLocations
    ConstraintDescription: Must be a valid F5 BIG-IP VE image type
    Default: Best
    Description: F5 BIG-IP Performance Type
    Type: String
  bigIpInstanceType:
    AllowedValues:
      - m3.2xlarge
      - m4.xlarge
      - m4.2xlarge
      - m4.4xlarge
      - m4.10xlarge
      - m5.large
      - m5.xlarge
      - m5.2xlarge
      - m5.4xlarge
      - c3.4xlarge
      - c3.8xlarge
      - c4.4xlarge
      - c4.8xlarge
      - c5.large
      - c5.xlarge
      - c5.2xlarge
      - c5.4xlarge
      - cc2.8xlarge
      - c5n.2xlarge
      - c5n.4xlarge
    ConstraintDescription: Must be a valid EC2 instance type for BIG-IP
    Default: m5.2xlarge
    Description: AWS instance type
    Type: String
  bigIpThroughput:
    AllowedValues:
      - 25Mbps
      - 200Mbps
      - 1000Mbps
      - 3000Mbps
      - 5000Mbps
      - 10000Mbps
    ConstraintDescription: Select the BIG-IP throughput you want to use
    Default: 1000Mbps
    Description: Maximum amount of throughput for BIG-IP VE
    Type: String
  bigIpRuntimeInitConfig01:
    Description: 'Supply a URL to the bigip-runtime-init configuration file in YAML
     or JSON format, or an escaped JSON string to use for f5-bigip-runtime-init configuration.'
    Type: String
    Default: 'https://aws-quickstart.s3.amazonaws.com/quickstarts-v2/declarations/runtime-init-conf-2nic-payg-instance01.yaml'
  bigIpRuntimeInitConfig02:
    Description: 'Supply a URL to the bigip-runtime-init configuration file in YAML
     or JSON format, or an escaped JSON string to use for f5-bigip-runtime-init configuration.'
    Type: String
    Default: 'https://aws-quickstart.s3.amazonaws.com/quickstarts-v2/declarations/runtime-init-conf-2nic-payg-instance02.yaml'
  bigIpRuntimeInitPackageUrl:
    Description: 'Supply a URL for the F5 BIG-IP Runtime Init Package install script.'
    Type: String
    Default: 'https://cdn.f5.com/product/cloudsolutions/f5-bigip-runtime-init/v1.4.1/dist/f5-bigip-runtime-init-1.4.1-1.gz.run'
  bigIpVersion:
    AllowedValues:
      - 16-1-2-2-0028
      - 14-1-4-6-008
    Default: 16-1-2-2-0028
    Description: Select version of BIG-IP you wish to deploy.
    Type: String
  cfeS3Bucket:
    AllowedPattern: '^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$'
    ConstraintDescription: 'S3 bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).'
    Default: aws-quickstart-cfe
    Description: 'S3 bucket name used by Cloud Failover Extension.'
    Type: String
  cfeTag:
    Description: Cloud Failover deployment tag value.
    Type: String
    Default: aws_quickstart
  cfeVipTag:
    Description: Cloud Failover VIP tag value; provides private ip addresses to be assigned to VIP public ip.
    Type: String
    Default: '10.0.20.101,10.0.10.101'
  cost:
    Default: f5cost
    Description: Cost Center Tag.
    Type: String
  environment:
    Default: f5env
    Description: Environment Tag.
    Type: String
  group:
    Default: f5group
    Description: Group Tag.
    Type: String
  owner:
    Default: f5owner
    Description: Owner Tag
    Type: String
  peerConfigSyncAddr:
    Default: 10.0.10.11
    Description: Type the static self IP address of the remote host here. Leave empty if not configuring peering with a remote host on this device.
    Type: String
  privateSubnet1ID:
    Description: Private Subnet1 ID.
    Type: AWS::EC2::Subnet::Id
  privateSubnet1SelfAddress:
    AllowedPattern: '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$'
    ConstraintDescription: IP address parameter must be in the form x.x.x.x
    Description: Private Subnet1 IP Address.
    Default: 10.0.11.11
    Type: String
  privateSubnet2ID:
    Description: Private Subnet2 ID.
    Type: AWS::EC2::Subnet::Id
  privateSubnet3ID:
    Description: Private Subnet2 ID.
    Type: AWS::EC2::Subnet::Id
  privateSubnet4ID:
    Description: Private Subnet2 ID.
    Type: AWS::EC2::Subnet::Id
  privateSubnet2SelfAddress:
    AllowedPattern: '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$'
    ConstraintDescription: IP address parameter must be in the form x.x.x.x
    Description: Private Subnet2 IP Address.
    Default: 10.0.21.11
    Type: String
  provisionExampleApp:
    AllowedValues:
      - 'true'
      - 'false'
    Default: 'false'
    Description: Flag to deploy the demo web application.
    Type: String
  publicSubnet1ID:
    Description: Public Subnet1 ID.
    Type: AWS::EC2::Subnet::Id
  publicSubnet1SelfAddress:
    AllowedPattern: '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$'
    ConstraintDescription: IP address parameter must be in the form x.x.x.x
    Description: Public Subnet1 IP Address.
    Default: 10.0.10.11
    Type: String
  publicSubnet1VipAddress:
    AllowedPattern: '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$'
    ConstraintDescription: IP address parameter must be in the form x.x.x.x
    Description: Public Subnet1 External Service IP Address.
    Default: 10.0.10.101
    Type: String
  publicSubnet2ID:
    Description: Public Subnet2 ID.
    Type: AWS::EC2::Subnet::Id
  publicSubnet2SelfAddress:
    AllowedPattern: '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$'
    ConstraintDescription: IP address parameter must be in the form x.x.x.x
    Description: Private Subnet2 IP Address.
    Default: 10.0.20.11
    Type: String
  publicSubnet2VipAddress:
    AllowedPattern: '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$'
    ConstraintDescription: IP address parameter must be in the form x.x.x.x
    Description: Public Subnet2 External Service IP Address.
    Default: 10.0.20.101
    Type: String
  restrictedSrcAddressMgmt:
    AllowedPattern: '(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})/(\d{1,2})'
    ConstraintDescription: Must be a valid IP CIDR range of the form x.x.x.x/x.
    Description: 'REQUIRED - The IP address range used to SSH and access BIG-IP management port.
      Restrict to your client IP. Ex. X.X.X.X/32. WARNING - For eval purposes only. Production should never have Management interface exposed to Internet.'
    MaxLength: '18'
    MinLength: '9'
    Type: String
  restrictedSrcAddressApp:
    AllowedPattern: '(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})/(\d{1,2})'
    ConstraintDescription: Must be a valid IP CIDR range of the form x.x.x.x/x.
    Description: 'REQUIRED - The IP address range that can be used to access web traffic
      (80/443) to the EC2 instances.'
    MaxLength: '18'
    MinLength: '9'
    Type: String
  s3BucketName:
    AllowedPattern: '^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$'
    ConstraintDescription: 'S3 bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).'
    Default: aws-quickstart
    Description: 'S3 bucket name for the modules. S3 bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).'
    Type: String
  s3BucketRegion:
    Default: us-east-1
    Description: 'Region where the Quick Start S3 bucket (s3BucketName) is hosted. When using your own bucket, you must specify this value.'
    Type: String
  s3KeyPrefix:
    AllowedPattern: '^[0-9a-zA-Z-/_.-]*$'
    ConstraintDescription: 'Use defaults unless customizing templates and assests that require alternate location. Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).'
    Default: quickstart-f5-big-ip-virtual-edition-ha/
    Description: 'S3 key prefix for the Quick Start assets. Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).'
    Type: String
  secretArn:
    Default: ''
    Description: ARN of Secrets Manager secret
    Type: String
  sshKey:
    Description: EC2 KeyPair to enable SSH access to EC2 instances which include BIG-IP, Bastion, and demo application instances.
    Type: 'AWS::EC2::KeyPair::KeyName'
  uniqueString:
    AllowedPattern: ^[a-zA-Z][a-zA-Z0-9]{1,11}$
    ConstraintDescription: Must Contain between 1 and 12 alphanumeric characters with first character as a letter.
    Default: myUniqStr
    Description: Unique String used when creating object names or Tags.
    Type: String
  vpc:
    Description: VPC Id for the deployment.
    Type: AWS::EC2::VPC::Id
Resources:
  Access:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL:
        !Sub
        - https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}templates/modules/access/access.yaml
        - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
          S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]
      Parameters:
        application: !Ref application
        cost: !Ref cost
        environment: !Ref environment
        group: !Ref group
        owner: !Ref owner
        s3Bucket: !Ref cfeS3Bucket
        secretArn: !Ref secretArn
        solutionType: failover
        uniqueString: !Ref uniqueString
  Dag:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL:
        !Sub
        - https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}templates/modules/dag/dag.yaml
        - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
          S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]
      Parameters:
        application: !Ref application
        cost: !Ref cost
        createAppSecurityGroup: 'true'
        createFailoverIngress: 'true'
        environment: !Ref environment
        group: !Ref group
        numberPublicExternalIpAddresses: !If [usePublicIpVip, 3, 2]
        numberPublicMgmtIpAddresses: 0
        owner: !Ref owner
        restrictedSrcAddressMgmt: !Ref restrictedSrcAddressMgmt
        restrictedSrcAddressApp: !Ref restrictedSrcAddressApp
        cfeTag: !Ref cfeTag
        cfeVipTag: !Ref cfeVipTag
        restrictedSrcPort: 443
        vpc: !Ref vpc
        uniqueString: !Ref uniqueString
  BigipInstance01:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL:
        !Sub
        - https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}templates/modules/bigip-standalone/bigip-standalone.yaml
        - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
          S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]
      Parameters:
        bigIpInstanceProfile: !GetAtt [Access, Outputs.bigIpInstanceProfile]
        bigIpRuntimeInitConfig: !Ref bigIpRuntimeInitConfig01
        bigIpRuntimeInitPackageUrl: !Ref bigIpRuntimeInitPackageUrl
        cfeS3Bucket: !Ref cfeS3Bucket
        cfeTag: !Ref cfeTag
        imageId: !If [noCustomImageId, !FindInMap [!FindInMap [VERSION, !Ref bigIpVersion, REGIONMAP], !Ref 'AWS::Region', !FindInMap [AWSBigipThroughput, !Ref bigIpThroughput, !Ref bigIpImageName]], !Ref bigIpImageId]
        externalPrimaryPublicId: !GetAtt [Dag, Outputs.bigIpExternalEipAllocationId01]
        externalPublicIpIds: !If [usePublicIpVip, !GetAtt [Dag, Outputs.bigIpExternalEipAllocationId03], '']
        externalSecurityGroupId: !GetAtt [Dag, Outputs.bigIpExternalSecurityGroup]
        externalSelfIp: !Ref publicSubnet1SelfAddress
        externalServiceIps: !Ref publicSubnet1VipAddress
        externalSubnetId: !Ref publicSubnet1ID
        instanceType: !Ref bigIpInstanceType
        internalSubnetId: !Ref 'AWS::NoValue'
        mgmtPublicIpId: ''
        mgmtSecurityGroupId: !GetAtt [Dag, Outputs.bigIpExternalSecurityGroup]
        mgmtSelfIp: !Ref privateSubnet1SelfAddress
        mgmtSubnetId: !Ref privateSubnet1ID
        numSecondaryPrivateIpAddress: !If [usePublicIpVip, 1, 0]
        peerConfigSyncAddr: ''
        sshKey: !Ref sshKey
        uniqueString: !Ref uniqueString
  BigipInstance02:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL:
        !Sub
        - https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}templates/modules/bigip-standalone/bigip-standalone.yaml
        - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
          S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]
      Parameters:
        bigIpInstanceProfile: !GetAtt [Access, Outputs.bigIpInstanceProfile]
        bigIpRuntimeInitConfig: !Ref bigIpRuntimeInitConfig02
        bigIpRuntimeInitPackageUrl: !Ref bigIpRuntimeInitPackageUrl
        imageId: !If [noCustomImageId, !FindInMap [!FindInMap [VERSION, !Ref bigIpVersion, REGIONMAP], !Ref 'AWS::Region', !FindInMap [AWSBigipThroughput, !Ref bigIpThroughput, !Ref bigIpImageName]], !Ref bigIpImageId]
        cfeTag: !Ref cfeTag
        externalPrimaryPublicId: !GetAtt [Dag, Outputs.bigIpExternalEipAllocationId02]
        externalPublicIpIds: ''
        externalSecurityGroupId: !GetAtt [Dag, Outputs.bigIpExternalSecurityGroup]
        externalSelfIp: !Ref publicSubnet2SelfAddress
        externalServiceIps: !Ref publicSubnet2VipAddress
        externalSubnetId: !Ref publicSubnet2ID
        instanceType: !Ref bigIpInstanceType
        internalSubnetId:  !Ref 'AWS::NoValue'
        mgmtPublicIpId: ''
        mgmtSecurityGroupId: !GetAtt [Dag, Outputs.bigIpExternalSecurityGroup]
        mgmtSelfIp: !Ref privateSubnet2SelfAddress
        mgmtSubnetId: !Ref privateSubnet2ID
        numSecondaryPrivateIpAddress: 0
        peerConfigSyncAddr: !Ref peerConfigSyncAddr
        sshKey: !Ref sshKey
        uniqueString: !Ref uniqueString
  Application01:
    Type: 'AWS::CloudFormation::Stack'
    Condition: provisionExampleApp
    Properties:
      TemplateURL:
        !Sub
        - https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}templates/modules/application/application.yaml
        - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
          S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]
      Parameters:
        appDockerImageName: !Ref 'appDockerImageName'
        application: !Ref 'application'
        applicationSubnet: !Ref privateSubnet3ID
        appSecurityGroupId: !GetAtt [Dag, Outputs.appSecurityGroupId]
        cost: !Ref 'cost'
        environment: !Ref 'environment'
        group: !Ref 'group'
        sshKey: !Ref 'sshKey'
        uniqueString: !Ref uniqueString
  Application02:
    Type: 'AWS::CloudFormation::Stack'
    Condition: provisionExampleApp
    Properties:
      TemplateURL:
        !Sub
        - https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${s3KeyPrefix}templates/modules/application/application.yaml
        - S3Region: !If [useDefaultBucket, !Ref AWS::Region, !Ref s3BucketRegion]
          S3Bucket: !If [useDefaultBucket, !Sub '${s3BucketName}-${AWS::Region}', !Ref s3BucketName]
      Parameters:
        appDockerImageName: !Ref 'appDockerImageName'
        application: !Ref 'application'
        applicationSubnet: !Ref privateSubnet4ID
        appSecurityGroupId: !GetAtt [Dag, Outputs.appSecurityGroupId]
        cost: !Ref 'cost'
        environment: !Ref 'environment'
        group: !Ref 'group'
        sshKey: !Ref 'sshKey'
        uniqueString: !Ref uniqueString
Outputs:
  access:
    Description: access nested stack name
    Value: !GetAtt [Access, Outputs.stackName]
  applicationPublicIp:
    Condition: usePublicIpVip
    Description: application VIP Public Ip
    Value: !GetAtt [Dag, Outputs.bigIpExternalEipAddress03]
  bigipInstance01:
    Description: bigip-standalone nested stack name
    Value: !GetAtt [BigipInstance01, Outputs.stackName]
  bigipInstance02:
    Description: bigip-standalone nested stack name
    Value: !GetAtt [BigipInstance02, Outputs.stackName]
  bigipInstanceMgmtPrivateIp01:
    Description: private management ip for BIGIP instance 01
    Value: !GetAtt [BigipInstance01, Outputs.bigIpManagementInterfacePrivateIp]
  bigipInstanceMgmtPrivateIp02:
    Description: private management ip for BIGIP instance 02
    Value: !GetAtt [BigipInstance02, Outputs.bigIpManagementInterfacePrivateIp]
  dag:
    Description: dag nested stack name
    Value: !GetAtt [Dag, Outputs.stackName]
  stackName:
    Description: workload nested stack name
    Value: !Ref "AWS::StackName"
