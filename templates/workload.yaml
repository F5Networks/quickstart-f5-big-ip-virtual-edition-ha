AWSTemplateFormatVersion: 2010-09-09
Description: >-
  This template deploys a high availability pair of BIG-IPs and demo applications **WARNING**
  This template creates multiple AWS resources including S3 bucket, IAM
  roles and other related resources. You will be billed for the AWS resources used if you
  create a stack from this template.(qs-1p2474b6a)
Mappings:
  AWSBigipThroughput:
    1000Mbps:
      AdvancedWaf: AdvancedWaf1000Mbps
      Best: Best1000Mbps
      PerAppVeAwaf: PerAppVeAwaf1000Mbps
    200Mbps:
      AdvancedWaf: AdvancedWaf200Mbps
      Best: Best200Mbps
      PerAppVeAwaf: PerAppVeAwaf200Mbps
    25Mbps:
      AdvancedWaf: AdvancedWaf25Mbps
      Best: Best25Mbps
      PerAppVeAwaf: PerAppVeAwaf25Mbps
    5000Mbps:
      Best: Best5000Mbps
    10000Mbps:
      Best: Best10000Mbps
  VERSION:
    15-1-2-009:
      REGIONMAP: TMOS1512009
    14-1-3-007:
      REGIONMAP: TMOS1413007
  TMOS1512009:
    ap-east-1:
      AdvancedWaf1000Mbps: ami-0ea5d4ba07cf17ddc
      AdvancedWaf200Mbps: ami-08c288271d3e99a09
      AdvancedWaf25Mbps: ami-02f60491f866e3db5
      Best10000Mbps: ami-07d621bf7762787a0
      Best1000Mbps: ami-0af73bd2ef2e84394
      Best200Mbps: ami-029287fc49b2e6678
      Best25Mbps: ami-0c0515d48efd1badc
      Best5000Mbps: ami-0b9b9b11ddc796775
      PerAppVeAwaf200Mbps: ami-049358fc954e68fd5
      PerAppVeAwaf25Mbps: ami-05fdc4b57d5cdbb48
      AllTwoBootLocations: ami-027359d3539a7f402
    ap-northeast-1:
      AdvancedWaf1000Mbps: ami-0eb13bdeea33c7886
      AdvancedWaf200Mbps: ami-02d4fed40390bf2b1
      AdvancedWaf25Mbps: ami-0298e5520c04c3074
      Best10000Mbps: ami-054feaf32716fc19e
      Best1000Mbps: ami-0afb52845fd32a69a
      Best200Mbps: ami-05335000aeb813389
      Best25Mbps: ami-0b73cc18ca6c572cf
      Best5000Mbps: ami-03b23aa06f2051b00
      PerAppVeAwaf200Mbps: ami-084343973f45cea31
      PerAppVeAwaf25Mbps: ami-01977aaf0981ba580
      AllTwoBootLocations: ami-047f96d6124026a69
    ap-northeast-2:
      AdvancedWaf1000Mbps: ami-0774ebbdcdd9a4ec8
      AdvancedWaf200Mbps: ami-0c2928af7b5d31535
      AdvancedWaf25Mbps: ami-09a0ad0b77f6e25ac
      Best10000Mbps: ami-040e2731b92c6a972
      Best1000Mbps: ami-042f5b0bba9cbe34e
      Best200Mbps: ami-08e92928916e78df4
      Best25Mbps: ami-0bf9bace88354d3c6
      Best5000Mbps: ami-0b621fdb464558f55
      PerAppVeAwaf200Mbps: ami-062bcade2c21e3151
      PerAppVeAwaf25Mbps: ami-028008f16246f315c
      AllTwoBootLocations: ami-077d7dcd06fbec777
    ap-south-1:
      AdvancedWaf1000Mbps: ami-0fdaff4ce51c317ec
      AdvancedWaf200Mbps: ami-054f982b239eb42a5
      AdvancedWaf25Mbps: ami-0c3be030e62be48ab
      Best10000Mbps: ami-01f4ae49f62bc09c5
      Best1000Mbps: ami-01728fd53d5026680
      Best200Mbps: ami-05dca4bc6881749d9
      Best25Mbps: ami-02ffb377b8c80f1d6
      Best5000Mbps: ami-027b965ab7faaece5
      PerAppVeAwaf200Mbps: ami-02561f7dc13c34fbb
      PerAppVeAwaf25Mbps: ami-036282c277e5f978d
      AllTwoBootLocations: ami-0d2f93ef049a8db3e
    ap-southeast-1:
      AdvancedWaf1000Mbps: ami-033500f40b38bc3b1
      AdvancedWaf200Mbps: ami-078c2dc1b74fce7de
      AdvancedWaf25Mbps: ami-00cfdfcfc526de3ab
      Best10000Mbps: ami-0d79c1d847ce98f6c
      Best1000Mbps: ami-06d9e89aa241a999f
      Best200Mbps: ami-0eefd1a407660a630
      Best25Mbps: ami-096aee0cfc45a95b6
      Best5000Mbps: ami-061b65c1945b27291
      PerAppVeAwaf200Mbps: ami-043872e1d88f47491
      PerAppVeAwaf25Mbps: ami-06579fb67a138a537
      AllTwoBootLocations: ami-0d0c3d0d97f5e6663
    ap-southeast-2:
      AdvancedWaf1000Mbps: ami-085154456a2d2ae7d
      AdvancedWaf200Mbps: ami-0551c8c156e76eb86
      AdvancedWaf25Mbps: ami-0c10a5d98c0cad94c
      Best10000Mbps: ami-0f1e06fc885e54bbe
      Best1000Mbps: ami-0fa5d9bde30093ea2
      Best200Mbps: ami-0e375da090a7894a7
      Best25Mbps: ami-03993da9064bd8fff
      Best5000Mbps: ami-0172ea76eb36027f2
      PerAppVeAwaf200Mbps: ami-05291acd311d99731
      PerAppVeAwaf25Mbps: ami-06b86c3e10573585f
      AllTwoBootLocations: ami-0c7ce5e18fed18d9d
    ca-central-1:
      AdvancedWaf1000Mbps: ami-054e34701944c0e15
      AdvancedWaf200Mbps: ami-0bb38268fb4b73228
      AdvancedWaf25Mbps: ami-04e4e61bf1951b08a
      Best10000Mbps: ami-09fcf9fa4b3569825
      Best1000Mbps: ami-0e5ef359469121c2a
      Best200Mbps: ami-015c907bf512d7f20
      Best25Mbps: ami-0c461ff798bf98fd7
      Best5000Mbps: ami-0f87b99196ef39de3
      PerAppVeAwaf200Mbps: ami-0e47208d2796276ea
      PerAppVeAwaf25Mbps: ami-07b8c007c1323e403
      AllTwoBootLocations: ami-0843a3563fcd380bc
    cn-north-1:
      AllTwoBootLocations: ami-0ff1ffebd6569f7af
    cn-northwest-1:
      AllTwoBootLocations: ami-032df16e1602f3f7d
    eu-central-1:
      AdvancedWaf1000Mbps: ami-01129c6885b431da3
      AdvancedWaf200Mbps: ami-05482c873facc1baa
      AdvancedWaf25Mbps: ami-04b7bd11d6fe4c933
      Best10000Mbps: ami-04a01688ae3921a5f
      Best1000Mbps: ami-0d1177a999bcd5bcb
      Best200Mbps: ami-0291a95d5e4f44472
      Best25Mbps: ami-058f2b65179572e47
      Best5000Mbps: ami-0d8488c18f7ef3c67
      PerAppVeAwaf200Mbps: ami-0adcf48e40c3c5a57
      PerAppVeAwaf25Mbps: ami-085ae72dd5f327d25
      AllTwoBootLocations: ami-05128a8f7168df296
    eu-north-1:
      AdvancedWaf1000Mbps: ami-09c96c724f5de4b6d
      AdvancedWaf200Mbps: ami-02f93d9ca478b9257
      AdvancedWaf25Mbps: ami-037ae20be8e901022
      Best10000Mbps: ami-05eba8aacff404c94
      Best1000Mbps: ami-0e9cb972d6b14f972
      Best200Mbps: ami-07299be86351f5fb4
      Best25Mbps: ami-0048bbf44f72f8b8a
      Best5000Mbps: ami-0971b5854303fbe54
      PerAppVeAwaf200Mbps: ami-059763712a9d0906c
      PerAppVeAwaf25Mbps: ami-07627dd9adabd738a
      AllTwoBootLocations: ami-083d0984ef1425f60
    eu-south-1:
      AllTwoBootLocations: ami-0e2a9b281297b3d6e
    eu-west-1:
      AdvancedWaf1000Mbps: ami-0dc9f5e43ae70794f
      AdvancedWaf200Mbps: ami-08311e3251a835d9f
      AdvancedWaf25Mbps: ami-04eb78344138910ce
      Best10000Mbps: ami-0aef6071b23821742
      Best1000Mbps: ami-0c7541ecb476f49db
      Best200Mbps: ami-02d2109c2829d8a80
      Best25Mbps: ami-06f683a5f48f6f650
      Best5000Mbps: ami-027b0c0b45ec87d42
      PerAppVeAwaf200Mbps: ami-095f3ed7c1d352afb
      PerAppVeAwaf25Mbps: ami-09fb235eb5dd78729
      AllTwoBootLocations: ami-049205a8d37b251d5
    eu-west-2:
      AdvancedWaf1000Mbps: ami-01e0138a297591825
      AdvancedWaf200Mbps: ami-015b7e197e7bb60c6
      AdvancedWaf25Mbps: ami-074165ba162fa4114
      Best10000Mbps: ami-0ef744ae5c5ebd3c0
      Best1000Mbps: ami-0c525dc708ed16ea1
      Best200Mbps: ami-04cce6d4007eab8d6
      Best25Mbps: ami-0ca3e0c61b7aa1ed8
      Best5000Mbps: ami-03ad8f9c50096b423
      PerAppVeAwaf200Mbps: ami-01c68f2ed86b5328d
      PerAppVeAwaf25Mbps: ami-0171aaeeef61cb410
      AllTwoBootLocations: ami-01479d6e2b047b2f0
    eu-west-3:
      AdvancedWaf1000Mbps: ami-0dc64224e6c263a8d
      AdvancedWaf200Mbps: ami-061645c4fd02b43b5
      AdvancedWaf25Mbps: ami-0b2f0167cbd1ae519
      Best10000Mbps: ami-0dfeb1e97e476f062
      Best1000Mbps: ami-00f77b46815e18cf1
      Best200Mbps: ami-0b080af6aa2c1cb9a
      Best25Mbps: ami-02382c8b84ff06570
      Best5000Mbps: ami-0cf93a42a9162995c
      PerAppVeAwaf200Mbps: ami-087d73d908fee5f36
      PerAppVeAwaf25Mbps: ami-09531848f783b48d1
      AllTwoBootLocations: ami-0b2c6dfdee66294a8
    me-south-1:
      AdvancedWaf1000Mbps: ami-0fcb21fdfbf922d23
      AdvancedWaf200Mbps: ami-0267cd7f890b013c3
      AdvancedWaf25Mbps: ami-015529cce249b9abd
      Best10000Mbps: ami-0f4e8f83fb75ee1de
      Best1000Mbps: ami-0d75fa4284dc7279f
      Best200Mbps: ami-0576caa206d86edfa
      Best25Mbps: ami-095369414b08bbf8d
      Best5000Mbps: ami-06c34f70ab2e818d2
      Better10000Mbps: ami-0dc025219efb1faf7
      PerAppVeAwaf200Mbps: ami-02731b0784a80c2f8
      PerAppVeAwaf25Mbps: ami-09ab3762459efac75
      AllTwoBootLocations: ami-0d4c9cd7812f02b98
    sa-east-1:
      AdvancedWaf1000Mbps: ami-0ac77800e287ed426
      AdvancedWaf200Mbps: ami-0d9b931e5540d3a8a
      AdvancedWaf25Mbps: ami-0487516b6386f4c67
      Best10000Mbps: ami-07a1979f20561f848
      Best1000Mbps: ami-0eb1370b32d1c3dd4
      Best200Mbps: ami-02b88b9224fdbd3ab
      Best25Mbps: ami-07d1e81fff95c53eb
      Best5000Mbps: ami-0ac377a277932675f
      PerAppVeAwaf200Mbps: ami-05d67cac5481b8743
      PerAppVeAwaf25Mbps: ami-0e1157de41d40e633
      AllTwoBootLocations: ami-0c3a66b6dea5e84d1
    us-east-1:
      AdvancedWaf1000Mbps: ami-0872dfb40409f5945
      AdvancedWaf200Mbps: ami-0a6a9805334a0bc10
      AdvancedWaf25Mbps: ami-0c387dd185aee40e8
      Best10000Mbps: ami-06d3f50a99bcdb1f9
      Best1000Mbps: ami-024c6b5b1d2029a72
      Best200Mbps: ami-09ab5f5a0703d23ee
      Best25Mbps: ami-0683a7625c726a0b1
      Best5000Mbps: ami-05a238f849858b0fd
      PerAppVeAwaf200Mbps: ami-095248207c018ae60
      PerAppVeAwaf25Mbps: ami-0a75bfc6db0f4c305
      AllTwoBootLocations: ami-0abfe223310f724aa
    us-east-2:
      AdvancedWaf1000Mbps: ami-0eae6c4d8f2a36358
      AdvancedWaf200Mbps: ami-01234e39c7cd2e1da
      AdvancedWaf25Mbps: ami-0fe2221efc09eda9a
      Best10000Mbps: ami-01cedd249790781a9
      Best1000Mbps: ami-0c3b8e26ca3783e21
      Best200Mbps: ami-0bc8ba8ceb5df75bb
      Best25Mbps: ami-0aed55631c87b383b
      Best5000Mbps: ami-0c3d0360427d64d37
      PerAppVeAwaf200Mbps: ami-0a4bc64348e7d35e3
      PerAppVeAwaf25Mbps: ami-060eaed7b23684c51
      AllTwoBootLocations: ami-0e4814cf1abddc148
    us-gov-east-1:
      AdvancedWaf1000Mbps: ami-097d6b2339fd8b997
      AdvancedWaf200Mbps: ami-0bdfce5cf4db02433
      AdvancedWaf25Mbps: ami-00f6c616ab175d71b
      Best10000Mbps: ami-0586ce9650372e0a4
      Best1000Mbps: ami-0a5b886fe325d162f
      Best200Mbps: ami-0db09a2ddd361b216
      Best25Mbps: ami-0026fe5f90e1bc6bb
      Best5000Mbps: ami-042042a0575f023db
      PerAppVeAwaf200Mbps: ami-00da861b687d92889
      PerAppVeAwaf25Mbps: ami-07f45ace479d02e50
      AllTwoBootLocations: ami-028af1e3984777e49
    us-gov-west-1:
      AdvancedWaf1000Mbps: ami-07c52253e9598d612
      AdvancedWaf200Mbps: ami-0b0579b649578c15d
      AdvancedWaf25Mbps: ami-054d1b1bd43e01aed
      Best10000Mbps: ami-0470ee4036b7b9fdc
      Best1000Mbps: ami-0c66d8da66f1f87bf
      Best200Mbps: ami-017607a2fc1669932
      Best25Mbps: ami-0981a32342217b2b9
      Best5000Mbps: ami-0dcf47a0d6956cb42
      PerAppVeAwaf200Mbps: ami-06a83ced61ebe1f54
      PerAppVeAwaf25Mbps: ami-033d70bad9bc51725
      AllTwoBootLocations: ami-0cfc79a3350b8b661
    us-west-1:
      AdvancedWaf1000Mbps: ami-06108c004b6873c2d
      AdvancedWaf200Mbps: ami-09126d34ae90a3539
      AdvancedWaf25Mbps: ami-070d1fb829c8b81f6
      Best10000Mbps: ami-0945c06a822c62cd0
      Best1000Mbps: ami-0419ad93266d2afe2
      Best200Mbps: ami-08c7d27d1ac021146
      Best25Mbps: ami-0f8c6798cf6773d31
      Best5000Mbps: ami-0f7978cb169e14820
      PerAppVeAwaf200Mbps: ami-0e2a36e012cb3bff5
      PerAppVeAwaf25Mbps: ami-017876396cdcf3ecc
      AllTwoBootLocations: ami-0a319cb19ce7767fa
    us-west-2:
      AdvancedWaf1000Mbps: ami-05060db3d2e6191d6
      AdvancedWaf200Mbps: ami-0a5db33dd418bc09f
      AdvancedWaf25Mbps: ami-0868f1b56308705c5
      Best10000Mbps: ami-0ac78a5a47767fa3e
      Best1000Mbps: ami-0cb75150bc8c97854
      Best200Mbps: ami-038a5fce19fe63c5e
      Best25Mbps: ami-055a0fb39729a5933
      Best5000Mbps: ami-02e7b9878c9bf7d20
      PerAppVeAwaf200Mbps: ami-0c0cdc838baba4289
      PerAppVeAwaf25Mbps: ami-02f76e93afbe2dfbe
      AllTwoBootLocations: ami-06827d241c67e3426
  TMOS1413007:
    ap-east-1:
      AdvancedWaf1000Mbps: ami-0a2a146fe58f06407
      AdvancedWaf200Mbps: ami-047b8b7c91e767a2b
      AdvancedWaf25Mbps: ami-0dc382da6e6ceb891
      Best10000Mbps: ami-09dec4348b230481c
      Best1000Mbps: ami-0dbd550d2db0d09f6
      Best200Mbps: ami-0feda88f2e70c14cd
      Best25Mbps: ami-01d560b53f090b490
      Best5000Mbps: ami-07d22873d71120c96
      PerAppVeAwaf200Mbps: ami-081a46529378ebb4e
      PerAppVeAwaf25Mbps: ami-00989e0045189dbb1
      AllTwoBootLocations: ami-053aa09e368a5678e
    ap-northeast-1:
      AdvancedWaf1000Mbps: ami-00f5fa34ae975f8e6
      AdvancedWaf200Mbps: ami-0e2728b5962fc3acf
      AdvancedWaf25Mbps: ami-05304af38e94cbb3a
      Best10000Mbps: ami-0e827d0507b03ddc1
      Best1000Mbps: ami-096a357903a5ce443
      Best200Mbps: ami-00de20104b159950f
      Best25Mbps: ami-0d1620b10723105f0
      Best5000Mbps: ami-0eb691076f7b9add5
      PerAppVeAwaf200Mbps: ami-02b0e3d6abab8ed67
      PerAppVeAwaf25Mbps: ami-0179ee79bdb467e99
      AllTwoBootLocations: ami-0d8aa34728646a4c9
    ap-northeast-2:
      AdvancedWaf1000Mbps: ami-00c505be77320fab4
      AdvancedWaf200Mbps: ami-0b29a6d8b974505ad
      AdvancedWaf25Mbps: ami-048b0bebba93bb872
      Best10000Mbps: ami-07a31b3a10434b0f7
      Best1000Mbps: ami-0f6798250c992c6f0
      Best200Mbps: ami-051ac3bdc337e76ec
      Best25Mbps: ami-029a8f769212f9603
      Best5000Mbps: ami-01a90ca1c083f0399
      PerAppVeAwaf200Mbps: ami-0155a5582722138aa
      PerAppVeAwaf25Mbps: ami-048ee795a3093cfa8
      AllTwoBootLocations: ami-0ce23048511c43424
    ap-south-1:
      AdvancedWaf1000Mbps: ami-0ac12f6c7aa82a567
      AdvancedWaf200Mbps: ami-0ed96472c442a357b
      AdvancedWaf25Mbps: ami-02405d71eb90471ec
      Best10000Mbps: ami-09f8fd071019cc750
      Best1000Mbps: ami-0b1956b48e7118a77
      Best200Mbps: ami-093a569d89ee11500
      Best25Mbps: ami-075df8288796d7e00
      Best5000Mbps: ami-0101587bd15c45e4d
      PerAppVeAwaf200Mbps: ami-0a86469c9b9b495d2
      PerAppVeAwaf25Mbps: ami-0b3b8b8cb7badc1cd
      AllTwoBootLocations: ami-0eb366f4a13c99909
    ap-southeast-1:
      AdvancedWaf1000Mbps: ami-0e3592464bfbd6980
      AdvancedWaf200Mbps: ami-0f301d09f8d1d1e1f
      AdvancedWaf25Mbps: ami-02abca90a67ad8d8a
      Best10000Mbps: ami-0dd32ac5051b25264
      Best1000Mbps: ami-0db3b4bcb4a6f62de
      Best200Mbps: ami-0999b8a611678ea22
      Best25Mbps: ami-01abd9afaa59bb27d
      Best5000Mbps: ami-01d8decea2327c400
      PerAppVeAwaf200Mbps: ami-09b77b1f15ffa7482
      PerAppVeAwaf25Mbps: ami-0372276160ba6c873
      AllTwoBootLocations: ami-053d8e7e503b6cb2f
    ap-southeast-2:
      AdvancedWaf1000Mbps: ami-0033777fed2e13fc1
      AdvancedWaf200Mbps: ami-0aade33195046b09b
      AdvancedWaf25Mbps: ami-0642a09110bdac953
      Best10000Mbps: ami-068dbfc66cad079cd
      Best1000Mbps: ami-06c27de54eb0a132f
      Best200Mbps: ami-0ff0c540f6218fe13
      Best25Mbps: ami-00a4a4e3e9eec3c01
      Best5000Mbps: ami-0f81d271cbca177c7
      PerAppVeAwaf200Mbps: ami-057170119d857ff3b
      PerAppVeAwaf25Mbps: ami-0d88b404cc7fbbdaa
      AllTwoBootLocations: ami-082ea501457be4eec
    ca-central-1:
      AdvancedWaf1000Mbps: ami-0eaed559cb148542a
      AdvancedWaf200Mbps: ami-0a6405393a5b1cb60
      AdvancedWaf25Mbps: ami-03bc57c3901b39a32
      Best10000Mbps: ami-052447c62174cee56
      Best1000Mbps: ami-0affa5451d4e92f14
      Best200Mbps: ami-076ef0089e1eb12a1
      Best25Mbps: ami-03f23c8ddc45f0d2a
      Best5000Mbps: ami-03ab2b2cb4309db57
      PerAppVeAwaf200Mbps: ami-0720599e50cefcb5d
      PerAppVeAwaf25Mbps: ami-04edf1f3ae0f4cac4
      AllTwoBootLocations: ami-050c22daeca66dcf7
    eu-central-1:
      AdvancedWaf1000Mbps: ami-0227e2edde08ed1ec
      AdvancedWaf200Mbps: ami-0b41039d76434fd5d
      AdvancedWaf25Mbps: ami-0e4c810fe28af2e1d
      Best10000Mbps: ami-0a56b6266ddd47149
      Best1000Mbps: ami-0f9d47814e715d48a
      Best200Mbps: ami-065ba4aab2e0022fc
      Best25Mbps: ami-05a023970fe2f9851
      Best5000Mbps: ami-0d5f9206eed05fe71
      PerAppVeAwaf200Mbps: ami-0ff83a5a3c7589a99
      PerAppVeAwaf25Mbps: ami-0bba4b751c051e5b1
      AllTwoBootLocations: ami-0cf195473423488bf
    eu-north-1:
      AdvancedWaf1000Mbps: ami-001fd93096e78781b
      AdvancedWaf200Mbps: ami-078919ffa1bd03df8
      AdvancedWaf25Mbps: ami-074f82359a5d56bd7
      Best10000Mbps: ami-0640fca6b58983e47
      Best1000Mbps: ami-091f65ddd1331ea55
      Best200Mbps: ami-06046e4aa4bc698bd
      Best25Mbps: ami-0e714ad161e499ce6
      Best5000Mbps: ami-0a63bb9fb512f46cf
      PerAppVeAwaf200Mbps: ami-01204e3a2b8525ed9
      PerAppVeAwaf25Mbps: ami-0a5e6652b86a22f5e
      AllTwoBootLocations: ami-01d83bfec59507115
    eu-south-1:
      AllTwoBootLocations: ami-0f36ed47c62a82cd4
    eu-west-1:
      AdvancedWaf1000Mbps: ami-01a89a5cdcacdbba6
      AdvancedWaf200Mbps: ami-0e685311907d9e510
      AdvancedWaf25Mbps: ami-0f8b9f310ebac7a91
      Best10000Mbps: ami-060bd4c7931cb32e8
      Best1000Mbps: ami-07bf2d05d2821a013
      Best200Mbps: ami-084d0fadbaeb5ac41
      Best25Mbps: ami-0bedd9609038a9fb8
      Best5000Mbps: ami-0ff42bb9a3b626fe6
      PerAppVeAwaf200Mbps: ami-024c397e021b771d0
      PerAppVeAwaf25Mbps: ami-0a6b0f7bd4e5f4a8b
      AllTwoBootLocations: ami-0549982dba4ffe14b
    eu-west-2:
      AdvancedWaf1000Mbps: ami-093d7c0420f1c81a6
      AdvancedWaf200Mbps: ami-05732634e22bcff39
      AdvancedWaf25Mbps: ami-0874fd9434bddf330
      Best10000Mbps: ami-0863b9bdbfd0ae894
      Best1000Mbps: ami-0170575210f9dff00
      Best200Mbps: ami-00eccabe22aa9e969
      Best25Mbps: ami-097f970e89d029461
      Best5000Mbps: ami-0a65b97eb1bc48b39
      PerAppVeAwaf200Mbps: ami-0ac71fe7a087bcc97
      PerAppVeAwaf25Mbps: ami-0afc86cd699a58e79
      AllTwoBootLocations: ami-0826277057e3e7019
    eu-west-3:
      AdvancedWaf1000Mbps: ami-01486c786db1758f8
      AdvancedWaf200Mbps: ami-039b8c8fa80cab41f
      AdvancedWaf25Mbps: ami-02404e44886b23c8c
      Best10000Mbps: ami-0ac2f1a4c30921d7b
      Best1000Mbps: ami-0b6f2d10e334130f6
      Best200Mbps: ami-0ba41afb3daa6254f
      Best25Mbps: ami-0d0896940ae63cb8e
      Best5000Mbps: ami-03a9b5dce094171c2
      PerAppVeAwaf200Mbps: ami-062a05980cdbc03a3
      PerAppVeAwaf25Mbps: ami-06e9079dcf42cacd4
      AllTwoBootLocations: ami-029bcee674b328604
    me-south-1:
      AdvancedWaf1000Mbps: ami-0b9a3ad6ca3048e69
      AdvancedWaf200Mbps: ami-02c68c97c03948a86
      AdvancedWaf25Mbps: ami-0300ff271c4ec9802
      Best10000Mbps: ami-091a415fcc1eca62d
      Best1000Mbps: ami-0e7e257eb5223eaa0
      Best200Mbps: ami-09b3fd68ae2495188
      Best25Mbps: ami-06eaf9f2c7be32f7e
      Best5000Mbps: ami-090bf01db2a526eb0
      PerAppVeAwaf200Mbps: ami-0a8939af9a64a462d
      PerAppVeAwaf25Mbps: ami-0fc6f072202c1651c
      AllTwoBootLocations: ami-03610f73ee513866a
    sa-east-1:
      AdvancedWaf1000Mbps: ami-0a5e15bf34e8bddf5
      AdvancedWaf200Mbps: ami-05deb2e849f72828c
      AdvancedWaf25Mbps: ami-0a5d0acf97c10acfc
      Best10000Mbps: ami-0a894a3d60f14cf2c
      Best1000Mbps: ami-0d471a007c2b3038c
      Best200Mbps: ami-0e36bf34cda455021
      Best25Mbps: ami-03d90af4bf3c18ca8
      Best5000Mbps: ami-0e64ee0244a78d5bf
      PerAppVeAwaf200Mbps: ami-088246c6e3526aded
      PerAppVeAwaf25Mbps: ami-082c187b832a9956e
      AllTwoBootLocations: ami-0426c169e093b77c1
    us-east-1:
      AdvancedWaf1000Mbps: ami-08a3f877fc7245105
      AdvancedWaf200Mbps: ami-013508d1c968fb3ea
      AdvancedWaf25Mbps: ami-0064144796a49474b
      Best10000Mbps: ami-04192a1bfba0597a2
      Best1000Mbps: ami-051be8f049c410f33
      Best200Mbps: ami-01e46959b41771289
      Best25Mbps: ami-05899b7bd54d76170
      Best5000Mbps: ami-06bac5a6c82f0a365
      PerAppVeAwaf200Mbps: ami-0f5d8881034988c3f
      PerAppVeAwaf25Mbps: ami-0007b77e6739cc4c8
      AllTwoBootLocations: ami-07f727e8c9639463a
    us-east-2:
      AdvancedWaf1000Mbps: ami-018794541caf270fa
      AdvancedWaf200Mbps: ami-09b4974ca4fda0ffc
      AdvancedWaf25Mbps: ami-04ac019efd61ce8f8
      Best10000Mbps: ami-00cdade19a7dffb75
      Best1000Mbps: ami-03a6e432b64084fb7
      Best200Mbps: ami-04c3ce427e36f2e3e
      Best25Mbps: ami-020b134fa157cfbf3
      Best5000Mbps: ami-01b9c44613f5a8be2
      PerAppVeAwaf200Mbps: ami-0a05e831e03e53cff
      PerAppVeAwaf25Mbps: ami-02f751a79275e136e
      AllTwoBootLocations: ami-0c50759bbdb416795
    us-gov-east-1:
      AdvancedWaf1000Mbps: ami-0244c2cb78614deeb
      AdvancedWaf200Mbps: ami-08dc0f7ab14b6d742
      AdvancedWaf25Mbps: ami-0ecc6bfeefe7f2a28
      Best10000Mbps: ami-01fb1ac1fd539bd14
      Best1000Mbps: ami-077ca717e6a723292
      Best200Mbps: ami-0fc0ee3fdd84984fc
      Best25Mbps: ami-0a94717c414c28eda
      Best5000Mbps: ami-0d5d98dd5352ae16b
      PerAppVeAwaf200Mbps: ami-09b704d2d19e97635
      PerAppVeAwaf25Mbps: ami-0c3856c60e08c4bd5
      AllTwoBootLocations: ami-0b000be8450b84b8a
    us-gov-west-1:
      AdvancedWaf1000Mbps: ami-03e3fbedec4a9c73f
      AdvancedWaf200Mbps: ami-0b35e42b866ce9d06
      AdvancedWaf25Mbps: ami-04d0e8333180546ff
      Best10000Mbps: ami-0ab7d982de2ae4089
      Best1000Mbps: ami-0916033efd3ff3431
      Best200Mbps: ami-07fa33296f6a6da1e
      Best25Mbps: ami-00600405166cbdd2e
      Best5000Mbps: ami-048e6014df424cb6e
      PerAppVeAwaf200Mbps: ami-00d710f816c7dc262
      PerAppVeAwaf25Mbps: ami-0a64aada5a9ef1b80
      AllTwoBootLocations: ami-02c5560cba5d104eb
    us-west-1:
      AdvancedWaf1000Mbps: ami-0530089453f778af6
      AdvancedWaf200Mbps: ami-0d02f0ad8c679de66
      AdvancedWaf25Mbps: ami-0cb87f033a13c90dd
      Best10000Mbps: ami-0e5fe6bbe090f56ec
      Best1000Mbps: ami-0a96c80c040c2ce3f
      Best200Mbps: ami-02c5fbc110255a901
      Best25Mbps: ami-0b9b41a37fc8ba83c
      Best5000Mbps: ami-0c6af4ba503df0cec
      PerAppVeAwaf200Mbps: ami-0722b4ef544623721
      PerAppVeAwaf25Mbps: ami-0a997032245bc5cfb
      AllTwoBootLocations: ami-0b0e5475dd377fd61
    us-west-2:
      AdvancedWaf1000Mbps: ami-091a6824369c869b0
      AdvancedWaf200Mbps: ami-0907bb5f9904b5b8c
      AdvancedWaf25Mbps: ami-0b3d340a106f77fe8
      Best10000Mbps: ami-05ac1df996bdc4847
      Best1000Mbps: ami-0cc81c5d8e2086716
      Best200Mbps: ami-032f5e1e32dc6d464
      Best25Mbps: ami-05fe354c47a0bc665
      Best5000Mbps: ami-05521a98eff576729
      PerAppVeAwaf200Mbps: ami-039c2ae8c90c2a287
      PerAppVeAwaf25Mbps: ami-07122e9684d899eec
      AllTwoBootLocations: ami-0ff28d6bcc8f04c28
Conditions:
  1nic: !Equals
    - 1
    - !Ref numNics
  2nic: !Or
    - !Condition 3nic
    - !Equals
      - 2
      - !Ref numNics
  3nic: !Equals
    - 3
    - !Ref numNics
  externalIpAddresses0: !Equals
    - 0
    - !Ref numberPublicExternalIPAddresses
  externalIpAddresses1: !Equals
    - 1
    - !Ref numberPublicExternalIPAddresses
  externalIpAddresses2: !Equals
    - 2
    - !Ref numberPublicExternalIPAddresses
  externalIpAddresses3: !Equals
    - 3
    - !Ref numberPublicExternalIPAddresses
  externalIpAddresses4: !Equals
    - 4
    - !Ref numberPublicExternalIPAddresses
  appUrl1: !Or
    - !Condition externalIpAddresses1
    - !Condition appUrl2
  appUrl2: !Or
    - !Condition externalIpAddresses2
    - !Condition appUrl3
  appUrl3: !Or
    - !Condition externalIpAddresses3
    - !Condition appUrl4
  appUrl4: !Condition externalIpAddresses4
  isPaygLicensing: !Equals
    - payg
    - !Ref licenseType
  noCustomImageId: !Equals
    - OPTIONAL
    - !Ref customImageId
  govCloudCondition: !Or [!Equals [!Ref 'AWS::Region', us-gov-west-1], !Equals [!Ref 'AWS::Region', us-gov-east-1]]
Metadata:
  'AWS::CloudFormation::Interface':
    ParameterGroups:
      - Label:
          default: Templates Location
        Parameters:
          - s3BucketName
          - s3KeyPrefix
      - Label:
          default: Network Configuration
        Parameters:
          - vpcCidr
          - vpc
      - Label:
          default: Amazon EC2 Configuration
        Parameters:
          - instanceType
          - numberPublicExternalIPAddresses
          - numNics
          - provisionPublicIP
          - restrictedSrcAddress
          - restrictedSrcAddressApp
          - setAppPublicIP
          - sshKey
      - Label:
          default: BIG-IP Configuration
        Parameters:
          - bigipRuntimeInitConfig01
          - bigipRuntimeInitConfig02
          - cfeS3Bucket
          - customImageId
          - imageName
          - licenseType
          - throughput
      - Label:
          default: Application Configuration
        Parameters:
          - appDockerImageName
      - Label:
          default: Resources Tags
        Parameters:
          - application
          - costcenter
          - environment
          - group
          - owner
    ParameterLabels:
      appDockerImageName:
        default: Application docker image name
      application:
        default: Application
      bigipRuntimeInitConfig01:
        default: BIG-IP Runtime Init config
      bigipRuntimeInitConfig02:
        default: BIG-IP Runtime Init config
      cfeS3Bucket:
        default: CFE S3 bucket
      costcenter:
        default: Cost Center
      customImageId:
        default: Custom Image Id
      environment:
        default: Environment
      group:
        default: Group
      imageName:
        default: F5 BIG-IP Performance Type (PAYG)
      instanceType:
        default: AWS instance type
      licenseType:
        default: Licence type
      numNics:
        default: Number of interfaces to create
      numberPublicExternalIPAddresses:
        default: Number of external public ip address to create
      owner:
        default: Owner
      provisionPublicIP:
        default: Provision Public IP addresses for the BIG-IP interfaces
      restrictedSrcAddress:
        default: Restricted source address to BIG-IP
      restrictedSrcAddressApp:
        default: Restricted source address to application
      s3BucketName:
        default: S3 bucket where Templates are Located
      s3KeyPrefix:
        default: S3 key prefix
      sshKey:
        default: EC2 KeyPair to enable SSH access to the BIG-IP instance
      throughput:
        default: BIG-IP VE throughput (PAYG)
      vpc:
        default: VPC ID
      vpcCidr:
        default: VPC CIDR
  Version: 1.0.0
Parameters:
  appDockerImageName:
    Default: 'f5devcentral/f5-demo-app:1.0.1'
    Description: Application docker image name
    Type: String
  application:
    Default: f5app
    Description: Name of the Application Tag
    Type: String
  bigipRuntimeInitConfig01:
    Description: URL for BIG-IP Runtime Init config
    Type: String
  bigipRuntimeInitConfig02:
    Description: URL for BIG-IP Runtime Init config
    Type: String
  cfeS3Bucket:
    AllowedPattern: '^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$'
    ConstraintDescription: 'S3 bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).'
    Default: aws-quickstart-cfe
    Description: 'S3 bucket name used by Cloud Failover Extension'
    Type: String
  costcenter:
    Default: f5costcenter
    Description: Cost Center Tag.
    Type: String
  customImageId:
    ConstraintDescription: Must be a valid AMI Id
    Default: OPTIONAL
    Description: 'If you would like to deploy using a custom BIG-IP image, provide the AMI Id.  **Note**: Unless specifically required, leave the default of **OPTIONAL**'
    MaxLength: 255
    MinLength: 1
    Type: String
  environment:
    Default: f5env
    Description: Environment Tag.
    Type: String
  group:
    Default: f5group
    Description: Group Tag.
    Type: String
  imageName:
    AllowedValues:
      - Best
      - AdvancedWaf
      - PerAppVeAwaf
    ConstraintDescription: Must be a valid F5 BIG-IP VE image type
    Default: Best
    Description: F5 BIG-IP Performance Type
    Type: String
  instanceType:
    AllowedValues:
      - m3.2xlarge
      - m4.xlarge
      - m4.2xlarge
      - m4.4xlarge
      - m4.10xlarge
      - m5.large
      - m5.xlarge
      - m5.2xlarge
      - m5.4xlarge
      - c3.4xlarge
      - c3.8xlarge
      - c4.4xlarge
      - c4.8xlarge
      - c5.large
      - c5.xlarge
      - c5.2xlarge
      - c5.4xlarge
      - cc2.8xlarge
      - c5n.2xlarge
      - c5n.4xlarge
    ConstraintDescription: Must be a valid EC2 instance type for BIG-IP
    Default: m5.2xlarge
    Description: AWS instance type
    Type: String
  licenseType:
    AllowedValues:
      - payg
      - byol
      - bigiq
    Default: payg
    Description: Specifies licence type used for BIG-IP VE
    Type: String
  numNics:
    Default: 2
    Description: Number of interfaces to create on BIG-IP instance. Maximum of 3 allowed. Minimum of 1 allowed.
    MaxValue: 3
    MinValue: 1
    Type: Number
  numberPublicExternalIPAddresses:
    Default: 1
    Description: Number of external public ip address to create and associate to external interface. Maximum of 4 allowed. Minimum of 0 allowed.
    MaxValue: 4
    MinValue: 1
    Type: Number
  owner:
    Default: f5owner
    Description: Owner Tag
    Type: String
  privateSubnet1ID:
    Description: Private Subnet1 ID.
    Type: AWS::EC2::Subnet::Id
  privateSubnet2ID:
    Description: Private Subnet2 ID.
    Type: AWS::EC2::Subnet::Id
  publicSubnet1ID:
    Description: Public Subnet1 ID.
    Type: AWS::EC2::Subnet::Id
  publicSubnet2ID:
    Description: Public Subnet2 ID.
    Type: AWS::EC2::Subnet::Id
  restrictedSrcAddress:
    AllowedPattern: '(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})/(\d{1,2})'
    ConstraintDescription: Must be a valid IP CIDR range of the form x.x.x.x/x.
    Description: ' The IP address range used to SSH and access management GUI on the EC2 instances'
    MaxLength: '18'
    MinLength: '9'
    Type: String
  restrictedSrcAddressApp:
    AllowedPattern: '(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})/(\d{1,2})'
    ConstraintDescription: Must be a valid IP CIDR range of the form x.x.x.x/x.
    Description: The IP address range that can be used to access web traffic (80/443) to the EC2 instances.
    MaxLength: '18'
    MinLength: '9'
    Type: String
  s3BucketName:
    AllowedPattern: '^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$'
    ConstraintDescription: 'S3 bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).'
    Default: aws-quickstart
    Description: 'S3 bucket name for the modules. S3 bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).'
    Type: String
  s3KeyPrefix:
    AllowedPattern: '^[0-9a-zA-Z-/_.-]*$'
    ConstraintDescription: 'Use defaults unless customizing templates and assests that require alternate location. Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).'
    Default: quickstart-f5-big-ip-virtual-edition-ha/
    Description: 'S3 key prefix for the Quick Start assets. Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).'
    Type: String
  sshKey:
    Description: EC2 KeyPair to enable SSH access to the BIG-IP instance
    Type: 'AWS::EC2::KeyPair::KeyName'
  throughput:
    AllowedValues:
      - 25Mbps
      - 200Mbps
      - 1000Mbps
      - 5000Mbps
      - 10000Mbps
    ConstraintDescription: Select the BIG-IP throughput you want to use
    Default: 1000Mbps
    Description: Maximum amount of throughput for BIG-IP VE
    Type: String
  version:
    AllowedValues:
      - 15-1-2-009
      - 14-1-3-007
    Default: 15-1-2-009
    Description: Select version of BIG-IP you wish to deploy.
    Type: String
  vpc:
    Description: VPC Id for the deployment.
    Type: AWS::EC2::VPC::Id
  vpcCidr:
    AllowedPattern: '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/(1[6-9]|2[0-8]))$'
    ConstraintDescription: CIDR block parameter must be in the form x.x.x.x/16-28
    Default: 10.0.0.0/16
    Description: CIDR block for the VPC
    Type: String
Resources:
  Access:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL:
        !Sub
        - https://${s3BucketName}.${s3Region}.amazonaws.com/${s3KeyPrefix}templates/modules/access/access.yaml
        - { s3Region: !If [govCloudCondition, s3-us-gov-west-1, s3] }
      Parameters:
        solutionType: failover
        s3Bucket: !Ref cfeS3Bucket
        application: !Ref application
        costcenter: !Ref costcenter
        environment: !Ref environment
        group: !Ref group
  Dag:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL:
        !Sub
        - https://${s3BucketName}.${s3Region}.amazonaws.com/${s3KeyPrefix}templates/modules/dag/dag.yaml
        - { s3Region: !If [govCloudCondition, s3-us-gov-west-1, s3] }
      Parameters:
        vpc: !Ref vpc
        restrictedSrcAddressApp: !Ref restrictedSrcAddressApp
        restrictedSrcAddress: !Ref restrictedSrcAddress
        restrictedSrcPort: 443
        createAppSecurityGroup: 'Yes'
        createFailoverIngress: 'Yes'
        application: !Ref application
        costcenter: !Ref costcenter
        environment: !Ref environment
        group: !Ref group
        numberPublicExternalIPAddresses: 3
        numberPublicMgmtIPAddresses: 0
  BigipInstance01:
    DependsOn:
      - Access
      - Dag
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL:
        !Sub
        - https://${s3BucketName}.${s3Region}.amazonaws.com/${s3KeyPrefix}templates/modules/bigip-standalone/bigip-standalone.yaml
        - { s3Region: !If [govCloudCondition, s3-us-gov-west-1, s3] }
      Parameters:
        sshKey: !Ref sshKey
        cfeS3Bucket: !Ref cfeS3Bucket
        customImageId: !If [noCustomImageId, !FindInMap [!FindInMap [VERSION, !Ref version, REGIONMAP], !Ref 'AWS::Region', !FindInMap [AWSBigipThroughput, !Ref throughput, !Ref imageName]], !Ref customImageId]
        instanceType: !Ref instanceType
        mgmtSubnetId: !Ref privateSubnet1ID
        mgmtSecurityGroupId: !GetAtt [Dag, Outputs.BigipExternalSecurityGroup]
        mgmtSelfIp: 10.0.11.180
        externalSubnetId: !Ref publicSubnet1ID
        externalSelfIp: 10.0.10.89
        externalServiceIPs: 10.0.10.90
        externalSecurityGroupId: !GetAtt [Dag, Outputs.BigipExternalSecurityGroup]
        externalPrimaryPublicId: !GetAtt [Dag, Outputs.BigipExternalEipAllocationId00]
        externalPublicIpIds: !GetAtt [Dag, Outputs.BigipExternalEipAllocationId01]
        internalSubnetId: !Ref 'AWS::NoValue'
        bigipRuntimeInitConfig: !Ref bigipRuntimeInitConfig01
        bigipInstanceProfile: !GetAtt [Access, Outputs.BigipInstanceProfile]
        numSecondaryPrivateIpAddress: 1
  BigipInstance02:
    DependsOn:
      - Access
      - Dag
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL:
        !Sub
        - https://${s3BucketName}.${s3Region}.amazonaws.com/${s3KeyPrefix}templates/modules/bigip-standalone/bigip-standalone.yaml
        - { s3Region: !If [govCloudCondition, s3-us-gov-west-1, s3] }
      Parameters:
        sshKey: !Ref sshKey
        customImageId: !If [noCustomImageId, !FindInMap [!FindInMap [VERSION, !Ref version, REGIONMAP], !Ref 'AWS::Region', !FindInMap [AWSBigipThroughput, !Ref throughput, !Ref imageName]], !Ref customImageId]
        instanceType: !Ref instanceType
        mgmtSubnetId: !Ref privateSubnet2ID
        mgmtSecurityGroupId: !GetAtt [Dag, Outputs.BigipExternalSecurityGroup]
        mgmtSelfIp: 10.0.21.218
        externalSubnetId: !Ref publicSubnet2ID
        externalSelfIp: 10.0.20.158
        externalServiceIPs: 10.0.20.157
        externalSecurityGroupId: !GetAtt [Dag, Outputs.BigipExternalSecurityGroup]
        externalPrimaryPublicId: !GetAtt [Dag, Outputs.BigipExternalEipAllocationId02]
        externalPublicIpIds: !GetAtt [Dag, Outputs.BigipExternalEipAllocationId03]
        internalSubnetId:  !Ref 'AWS::NoValue'
        bigipRuntimeInitConfig: !Ref bigipRuntimeInitConfig02
        bigipInstanceProfile: !GetAtt [Access, Outputs.BigipInstanceProfile]
        numSecondaryPrivateIpAddress: 0
Outputs:
  access:
    Description: access nested stack name
    Value: !GetAtt [Access, Outputs.StackName]
  bigipInstance01:
    Description: bigip-standalone nested stack name
    Value: !GetAtt [BigipInstance01, Outputs.StackName]
  bigipInstance02:
    Description: bigip-standalone nested stack name
    Value: !GetAtt [BigipInstance02, Outputs.StackName]
  dag:
    Description: dag nested stack name
    Value: !GetAtt [Dag, Outputs.StackName]
